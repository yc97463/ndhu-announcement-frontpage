<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>National Dong Hwa University - Announcements</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          fontFamily: {
            sans: '"Noto Sans TC", Arial, sans-serif',
          },
          container: {
            padding: "1rem",
            center: true,
            screens: {
              xl: "1024px",
            },
          },
          extend: {
            backgroundImage: {},
            opacity: {
              15: "0.15",
            },
          },
        },
      };
    </script>
    <style type="text/tailwindcss">
      @layer utilities {
        .content-auto {
          content-visibility: auto;
        }
      }
    </style>
    <base href="https://announce.ndhu.edu.tw/" />
  </head>
  <body>
    <div class="container my-6">
      <h1 class="text-4xl font-medium mb-4">國立東華大學公告</h1>
      <div id="article"></div>
    </div>

    <script type="text/javascript">
      let article = document.getElementById("article");

      function countDays(date) {
        let now = new Date();
        let target = new Date(date);
        let diff = now.getTime() - target.getTime();
        let days = Math.floor(diff / (1000 * 60 * 60 * 24));

        if (days <= 0) {
          // return n minutes ago
          let minutes = Math.floor(diff / (1000 * 60));
          console.log(minutes);
          if (minutes <= 5) {
            return "剛剛";
          } else if (minutes <= 60) {
            return `${minutes} 分鐘前`;
          } else {
            return `${Math.floor(minutes / 60)} 小時前`;
          }
        } else if (days == 1) {
          return "昨天";
        } else if (days == 2) {
          return "前天";
        } else {
          return `${days} 天前`;
        }
      }

      async function getArticle(timestamp) {
        return await fetch(
          `https://yc97463.github.io/ndhu-announcement/${timestamp}.json`
        ).then((res) => res.json());
      }
      window.onload = async () => {
        let timestamp = new URLSearchParams(window.location.search).get("id");
        let announcement = await getArticle(timestamp).then((res) => res[0]);

        article.innerHTML += `
          <div class="border-2 border-slate-400 rounded-md my-4 p-3 overflow-x-auto">
            <h2 class="mb-1">
              <span class="bg-sky-500/75 text-white py-[2px] px-[8px] mr-2 rounded-lg">#${
                announcement.department
              }</span>${announcement.title}
            </h2>
            <p>${countDays(announcement.date)}</p>
            <hr class="my-2" />
            <p class="">${
              announcement.content
                .split(`<hr class="clear-contentunit"/>`)[1]
                .split(`<hr/>`)[0]
            }</p>

            <hr class="my-2" />

            <h3 class="text-xl font-medium mb-2">附件</h3>
            <ul>
              ${
                announcement.content
                  .split(`<hr class="clear-contentunit"/>`)[1]
                  .split(`<hr/>`)[1]
                  .split(`<p>`)[1]
              }
            </ul>
          </div>
          `;
      };
    </script>
  </body>
</html>
